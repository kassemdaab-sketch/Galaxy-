<script>
        let currentTail = 'rainbow', hue = 0, timerInterval, isCloaked = false;
        let starDensity = 70, starVelocity = 1.0, tailParticleDensity = 1;
        let starObjects = [];

        const cloaks = {
            docs: { title: "Google Docs", icon: "https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico" },
            drive: { title: "My Drive - Google Drive", icon: "https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png" },
            classroom: { title: "Classes", icon: "https://ssl.gstatic.com/classroom/favicon.png" },
            sheets: { title: "Google Sheets", icon: "https://ssl.gstatic.com/docs/spreadsheets/favicon3.ico" },
            slides: { title: "Google Slides", icon: "https://ssl.gstatic.com/docs/presentations/images/favicon5.ico" },
            gmail: { title: "Gmail", icon: "https://ssl.gstatic.com/ui/v1/icons/mail/images/favicon5.ico" },
            canvas: { title: "Dashboard", icon: "https://du11bjcvkw674.cloudfront.net/favicon.ico" },
            teams: { title: "Microsoft Teams", icon: "https://statics.teams.cdn.office.net/evergreen-assets/apps/teams_app_icon_v2.ico" },
            zoom: { title: "Zoom", icon: "https://st1.zoom.us/zoom.ico" },
            wikipedia: { title: "Wikipedia", icon: "https://en.wikipedia.org/static/favicon/wikipedia.ico" },
            youtube: { title: "YouTube", icon: "https://www.youtube.com/s/desktop/28e029f1/img/favicon_32x32.png" },
            outlook: { title: "Outlook", icon: "https://res.cdn.office.net/owamail/20231020005.01/resources/images/favicon.ico" },
            none: { title: "GALAXY PRO", icon: "https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico" }
        };

        // --- KEYBIND COMMANDS ---
        window.addEventListener('keydown', (e) => {
            if (e.altKey && e.key.toLowerCase() === 'p') { e.preventDefault(); window.open(document.getElementById('btn-proxies').href, '_blank'); }
            if (e.ctrlKey && e.key.toLowerCase() === 'm') { e.preventDefault(); window.open(document.getElementById('btn-movies').href, '_blank'); }
            if (e.ctrlKey && e.key.toLowerCase() === 'g') { e.preventDefault(); window.open(document.getElementById('btn-games').href, '_blank'); }
            if (e.ctrlKey && e.key.toLowerCase() === 's') { e.preventDefault(); toggleScanlines(); saveSettings(); }
            if (e.ctrlKey && e.key.toLowerCase() === 'r') { e.preventDefault(); toggleRainbow(); saveSettings(); }
            if (e.ctrlKey && e.key.toLowerCase() === 'e') { e.preventDefault(); toggleEngine(); saveSettings(); }
            if (e.key === '`') { e.preventDefault(); window.location.href = document.getElementById('panic-url').value || "https://classroom.google.com"; }
            if (e.key === 'Escape') { e.preventDefault(); toggleStealth(); }
            if (e.ctrlKey && e.key.toLowerCase() === 'b') { 
                if(confirm("WIPE SYSTEM?")) { localStorage.clear(); location.reload(); }
            }
        });

        // --- CORE ENGINES ---
        function setStars() {
            const container = document.getElementById('stars-canvas');
            container.innerHTML = ''; starObjects = [];
            for(let i=0; i<starDensity; i++) {
                const s = document.createElement('div');
                s.className = 'star';
                let size = Math.random()*2+1;
                starObjects.push({ el: s, x: Math.random()*100, y: Math.random()*100, speed: size * 0.05 });
                s.style.width = size+'px'; s.style.height = size+'px';
                container.appendChild(s);
            }
        }

        function animateStars() {
            starObjects.forEach(s => {
                s.y += s.speed * starVelocity;
                if(s.y > 105) s.y = -5;
                s.el.style.left = s.x + '%';
                s.el.style.top = s.y + '%';
            });
            requestAnimationFrame(animateStars);
        }

        function createTail(e) {
            if(currentTail === 'void') return;
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.left = e.clientX + 'px';
            p.style.top = e.clientY + 'px';
            const size = Math.random() * 8 + 2;
            p.style.width = size + 'px'; p.style.height = size + 'px';
            
            // Tail Styles
            if(currentTail === 'rainbow') p.style.background = `hsl(${Math.random()*360}, 100%, 50%)`;
            else if(currentTail === 'neon') p.style.background = 'var(--accent)';
            else if(currentTail === 'spark') p.style.background = '#fff';
            else if(currentTail === 'shock') { p.style.background = '#00ffff'; p.style.borderRadius = '0'; }
            else if(currentTail === 'ghost') { p.style.background = 'rgba(255,255,255,0.2)'; p.style.filter = 'blur(4px)'; }

            document.body.appendChild(p);
            setTimeout(() => {
                p.style.transform = `translate(${(Math.random()-0.5)*50}px, ${Math.random()*50}px) scale(0)`;
                p.style.opacity = '0';
                setTimeout(() => p.remove(), 800);
            }, 10);
        }

        // --- UI & STATE ---
        function handleMouseMove(e) {
            document.body.style.setProperty('--mouse-x', e.clientX + 'px');
            document.body.style.setProperty('--mouse-y', e.clientY + 'px');
            for (let i = 0; i < tailParticleDensity; i++) createTail(e);
        }

        function loadSession() {
            const user = localStorage.getItem('galaxy_user');
            if (!user) {
                document.getElementById('auth-overlay').style.display = 'flex';
                return;
            }
            document.getElementById('auth-overlay').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('pilot-id').innerText = "PILOT: " + user.toUpperCase();
            
            const saved = JSON.parse(localStorage.getItem('galaxy_settings_pro'));
            if(saved) {
                if(saved.rainbow) toggleRainbow();
                if(saved.scanlines) toggleScanlines();
                if(saved.glitch) toggleEngine();
                updateHue(saved.hue || 280);
                setTail(saved.tail || 'rainbow');
                updateDensity(saved.density || 70);
                updateVelocity(saved.velocity || 1.0);
            }
            setStars(); animateStars();
            setInterval(() => {
                document.getElementById('neural-clock').innerText = new Date().toLocaleTimeString();
            }, 1000);
        }

        function setTail(type) { currentTail = type; logMessage("SYSTEM: TAIL_" + type.toUpperCase()); }
        function login() { 
            const name = document.getElementById('user-in').value || "PILOT";
            localStorage.setItem('galaxy_user', name); 
            location.reload(); 
        }
        function logout() { localStorage.removeItem('galaxy_user'); location.reload(); }
        function logMessage(msg) {
            const lb = document.getElementById('system-logs');
            const div = document.createElement('div');
            div.innerText = `> [${new Date().toLocaleTimeString()}] ${msg}`;
            lb.prepend(div);
            if(lb.childNodes.length > 6) lb.lastChild.remove();
        }

        // Initialize
        window.onload = loadSession;
    </script>
</body>
</html>
