// Replace the old launchInTab with this smarter version
function launchInTab(target) {
    addLog("ROUTING THROUGH GALAXY UPLINK...");
    const cloak = document.getElementById('cloak-select').value;
    const identities = {
        docs: ["Google Docs", "https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico"],
        classroom: ["Classes", "https://ssl.gstatic.com/classroom/favicon.png"],
        canvas: ["Dashboard", "https://du11bjcvkw674.cloudfront.net/favicon.ico"]
    };
    const [title, icon] = identities[cloak];

    // This ensures we use our Node.js service for everything
    const proxyUrl = `/service?url=${encodeURIComponent(target)}`;

    document.open();
    document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>${title}</title>
            <link rel="icon" href="${icon}">
            <style>body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #000; } iframe { width: 100%; height: 100%; border: none; }</style>
        </head>
        <body>
            <iframe src="${proxyUrl}"></iframe>
            <script>
                window.addEventListener('keydown', (e) => { if (e.key === '\`') window.location.replace('https://classroom.google.com'); });
            <\/script>
        </body>
        </html>
    `);
    document.close();
}
